# ðŸš€ Next.js Deployment Checklist - Vercel

## Pre-Deployment Setup

### 1. Environment Variables

Set the following in **Vercel Dashboard** â†’ **Project Settings** â†’ **Environment Variables**:

#### Required (Production)
```bash
# Application URLs
NEXT_PUBLIC_APP_URL=https://petrolpricenearme.com.au
NEXT_PUBLIC_SITE_URL=https://petrolpricenearme.com.au
NODE_ENV=production

# Baserow Integration (REQUIRED)
BASEROW_API_TOKEN=WXGOdiCeNmvdj5NszzAdvIug3InwQQXP
BASEROW_API_URL=https://api.baserow.io
BASEROW_STATIONS_TABLE_ID=623329
BASEROW_PRICES_TABLE_ID=623330

# Map Services
NEXT_PUBLIC_MAPBOX_ACCESS_TOKEN=pk.eyJ1IjoicGV0cm9scHJpY2VzIiwiYSI6ImNtZW82a2ZkbzEzZzEycHB4bnN2a3d6MWYifQ.hOEEwKVHFhA2_IAxvj59SA

# Authentication
NEXTAUTH_SECRET=generate_secure_random_32_char_string
NEXTAUTH_URL=https://petrolpricenearme.com.au
```

#### Optional
```bash
# Analytics
NEXT_PUBLIC_GA_TRACKING_ID=G-XXXXXXXXXX
NEXT_PUBLIC_ENABLE_ANALYTICS=true

# Monitoring
SENTRY_DSN=your_sentry_dsn
```

### 2. Build Optimization

âœ… **Verify Next.js configuration** (`next.config.ts`):
- âœ… SWC minification enabled (default in Next.js 15+)
- âœ… Image optimization configured
- âœ… Static asset caching headers
- âœ… Security headers configured
- âœ… Standalone output mode for faster cold starts

### 3. SEO Files

âœ… **Verify SEO files exist**:
- âœ… `public/sitemap.xml` (auto-generated by next-sitemap)
- âœ… `public/robots.txt` (auto-generated by next-sitemap)
- âœ… `src/app/robots.ts` (Next.js robots handler)
- âœ… `src/app/manifest.json` (PWA manifest)

### 4. Analytics Setup

âœ… **Vercel Analytics** (Automatic):
- No setup required - auto-enabled on Vercel deployments

âœ… **Google Analytics** (Optional):
1. Add `NEXT_PUBLIC_GA_TRACKING_ID` environment variable
2. Code is already integrated in `src/components/analytics/`

---

## Deployment Steps

### Automatic Deployment (Recommended)

1. **Push to GitHub/Main**:
   ```bash
   git add .
   git commit -m "Ready for deployment"
   git push origin main
   ```

2. **Vercel will automatically**:
   - Detect the push
   - Run `npm run build`
   - Generate sitemap (via `postbuild` script)
   - Deploy to production

### Manual Deployment

1. **Install Vercel CLI** (if not installed):
   ```bash
   npm i -g vercel
   ```

2. **Login to Vercel**:
   ```bash
   vercel login
   ```

3. **Deploy to Production**:
   ```bash
   vercel --prod
   ```

4. **Verify deployment**:
   ```bash
   vercel ls
   ```

---

## Post-Deployment Verification

### âœ… Critical Checks

#### 1. Homepage Loads
- [ ] Visit `https://petrolpricenearme.com.au`
- [ ] No console errors
- [ ] Page loads quickly (< 2s)

#### 2. Data Loads Correctly
- [ ] Station directory shows stations
- [ ] Prices are displayed
- [ ] Search functionality works
- [ ] Filters work correctly

#### 3. Maps Load
- [ ] Map page is accessible
- [ ] Markers appear on map
- [ ] No Mapbox errors in console

#### 4. SEO Files
- [ ] `https://petrolpricenearme.com.au/sitemap.xml` is accessible
- [ ] `https://petrolpricenearme.com.au/robots.txt` is accessible
- [ ] Sitemap contains all pages

#### 5. Performance
- [ ] Run Lighthouse audit (score > 90)
- [ ] Check Core Web Vitals
- [ ] Mobile responsive works

#### 6. Security Headers
- [ ] Check headers via: `curl -I https://petrolpricenearme.com.au`
- [ ] Verify security headers are present:
  - `Strict-Transport-Security`
  - `X-Frame-Options`
  - `X-Content-Type-Options`
  - `Referrer-Policy`

### ðŸ“Š Analytics Verification

#### 1. Vercel Analytics
- [ ] Dashboard shows page views
- [ ] Real user monitoring data appears

#### 2. Google Analytics (if enabled)
```bash
# In browser console (production):
gtag('config', 'G-XXXXXXXXXX')
```

#### 3. Web Vitals
- [ ] Check Vercel Analytics â†’ Web Vitals tab
- [ ] LCP < 2.5s
- [ ] FID < 100ms
- [ ] CLS < 0.1

---

## Build Scripts Reference

```bash
# Development
npm run dev              # Start dev server (localhost:3000)

# Production Build
npm run build            # Build for production
npm run start            # Start production server locally

# Quality Checks
npm run lint             # Run ESLint
npm run type-check       # TypeScript checking
npm run quality          # All quality checks
npm run quality:fix      # Auto-fix issues

# Testing
npm run test             # Run unit tests
npm run test:e2e         # End-to-end tests
npm run test:coverage    # Generate coverage report

# Analysis
npm run analyze         # Bundle analysis
npm run lighthouse       # Performance audit

# Deployment
npm run build            # Build for Vercel
```

---

## Troubleshooting

### Build Fails

**Issue**: TypeScript errors block build
**Solution**: Already configured to ignore during build
```typescript
// next.config.ts
typescript: { ignoreBuildErrors: true }
```

**Issue**: ESLint errors block build
**Solution**: Already configured to ignore during build
```typescript
// next.config.ts
eslint: { ignoreDuringBuilds: true }
```

### Environment Variables Not Loading

**Symptoms**:
- Station data doesn't load
- Maps don't work
- API calls fail

**Solution**:
1. Check Vercel Dashboard â†’ Environment Variables
2. Ensure all required variables are set
3. Verify production environment is selected
4. Redeploy after changing variables

### Sitemap Not Generating

**Check**:
- `next-sitemap.config.js` exists
- `postbuild` script in `package.json`
- Build completes successfully

**Manual regeneration**:
```bash
npm run sitemap:generate
```

---

## Recommended Settings

### Vercel Dashboard

**Project Settings** â†’ **General**:
- Framework Preset: `Next.js`
- Build Command: `next build`
- Output Directory: `.next`
- Install Command: `npm install`
- Node Version: `22.x`

**Project Settings** â†’ **Functions**:
- Memory: `1024 MB` (for API routes)
- Max Duration: `10 seconds`

**Project Settings** â†’ **Deploy Hooks**:
- None required (automatic on git push)

---

## Performance Targets

- âœ… First Contentful Paint (FCP): < 1.8s
- âœ… Largest Contentful Paint (LCP): < 2.5s
- âœ… Time to Interactive (TTI): < 3.8s
- âœ… Cumulative Layout Shift (CLS): < 0.1
- âœ… First Input Delay (FID): < 100ms
- âœ… Lighthouse Performance Score: > 90

---

## Security Checklist

- âœ… HTTPS enforced
- âœ… Security headers configured
- âœ… CORS properly configured
- âœ… Rate limiting enabled
- âœ… Input validation on all inputs
- âœ… XSS protection enabled
- âœ… CSRF protection enabled
- âœ… Environment variables secured
- âœ… No sensitive data in client bundle

---

## Monitoring

### Vercel Dashboard
- Monitor deployments
- View function logs
- Check build logs
- Monitor edge network status

### Analytics
- Vercel Analytics (automatic)
- Google Analytics (if configured)
- Web Vitals tracking

### Error Tracking
- Sentry (if configured)
- Browser console errors
- Server logs in Vercel

---

## Rollback Procedure

If deployment has issues:

1. **Via Vercel Dashboard**:
   - Go to Deployments
   - Find previous successful deployment
   - Click "â‹¯" â†’ "Promote to Production"

2. **Via CLI**:
   ```bash
   vercel rollback
   ```

3. **Via Git**:
   ```bash
   git revert HEAD
   git push origin main
   ```

---

## Maintenance

### Regular Tasks

- [ ] Weekly: Check error rates in Vercel
- [ ] Monthly: Review analytics data
- [ ] Quarterly: Update dependencies
- [ ] Quarterly: Security audit
- [ ] Annually: SSL certificate renewal (automatic on Vercel)

### Updates

```bash
# Update dependencies
npm update

# Update Next.js specifically
npm install next@latest react@latest react-dom@latest

# Run tests after updates
npm run test:all

# Verify build still works
npm run build
```

---

## Success Criteria

Your deployment is successful when:

âœ… Production site is live at `https://petrolpricenearme.com.au`
âœ… All environment variables are configured
âœ… Station data loads correctly
âœ… Maps are functional
âœ… SEO files are accessible
âœ… Analytics is tracking
âœ… Performance scores are > 90
âœ… No console errors
âœ… Mobile responsive
âœ… Security headers are present

---

**Last Updated**: December 2024
**Next Review**: January 2025