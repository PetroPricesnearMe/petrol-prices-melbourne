#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Ensure Git is in PATH (Windows fix)
if [ -d "/c/Program Files/Git/cmd" ]; then
  export PATH="/c/Program Files/Git/cmd:$PATH"
elif [ -d "/c/Program Files (x86)/Git/cmd" ]; then
  export PATH="/c/Program Files (x86)/Git/cmd:$PATH"
fi

echo "üîç Running pre-commit checks..."

# Run lint-staged
npx --yes lint-staged || {
  echo "‚ùå Lint-staged failed. Fix errors and try again."
  exit 1
}

# Check for console.logs (except console.warn/error)
if command -v git >/dev/null 2>&1; then
  if git diff --cached --name-only | grep -E '\.(ts|tsx|js|jsx)$' | xargs grep -n 'console\.log' 2>/dev/null; then
    echo "‚ùå Found console.log statements. Please remove them or use console.warn/console.error instead."
    exit 1
  fi
else
  echo "‚ö†Ô∏è  Git not found, skipping console.log check"
fi

echo "‚úÖ Pre-commit checks passed!"
