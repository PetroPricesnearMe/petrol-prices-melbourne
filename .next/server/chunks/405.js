"use strict";exports.id=405,exports.ids=[405],exports.modules={405:(a,b,c)=>{c.d(b,{qh:()=>j,oe:()=>h,Ar:()=>i});let d={SEARCH_PERFORMED:"search_performed",FILTER_APPLIED:"filter_applied",STATION_VIEWED:"station_viewed",STATION_CLICKED:"station_clicked",DIRECTIONS_CLICKED:"directions_clicked",PHONE_CLICKED:"phone_clicked",PAGE_VIEW:"page_view",SESSION_END:"session_end",TIME_ON_PAGE:"time_on_page"};class e{constructor(){this.events=[],this.sessionId=this.generateSessionId(),this.sessionStartTime=Date.now(),this.loadFromStorage(),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.trackEvent(d.SESSION_END,{duration:Date.now()-this.sessionStartTime,reason:"visibility_hidden"})}),window.addEventListener("pagehide",()=>{this.trackEvent(d.SESSION_END,{duration:Date.now()-this.sessionStartTime,reason:"page_hide"})})}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}loadFromStorage(){try{let a=localStorage.getItem("ppnm_analytics");if(a){let b=JSON.parse(a);this.events=b.events||[]}}catch(a){console.warn("Failed to load analytics from storage:",a)}}saveToStorage(){try{let a={events:this.events.slice(-1e3),lastUpdated:Date.now()};localStorage.setItem("ppnm_analytics",JSON.stringify(a))}catch(a){console.warn("Failed to save analytics to storage:",a)}}trackEvent(a,b={}){try{let c={id:`event_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,type:a,timestamp:Date.now(),sessionId:this.sessionId,data:b,page:window.location.pathname,userAgent:navigator.userAgent};this.events.push(c),this.saveToStorage(),this.sendToExternalAnalytics(c)}catch(a){}}sendToExternalAnalytics(a){try{((a,b={})=>{try{if(!window.gtag)return;window.gtag("event",a,{...b,send_to:process.env.REACT_APP_GA_MEASUREMENT_ID})}catch(a){}})(a.type,{event_category:this.getCategoryFromEventType(a.type),event_label:a.data.query||a.data.stationId||a.data.filterType||"unknown",value:a.data.value||0,session_id:this.sessionId,page_path:window.location.pathname,...a.data})}catch(a){}try{window.fbq&&window.fbq("trackCustom",a.type,a.data)}catch(a){}process.env.REACT_APP_ANALYTICS_ENDPOINT&&fetch(process.env.REACT_APP_ANALYTICS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}).catch(a=>console.warn("Analytics endpoint error:",a))}getCategoryFromEventType(a){return({[d.SEARCH_PERFORMED]:"Search",[d.FILTER_APPLIED]:"Filter",[d.STATION_CLICKED]:"Engagement",[d.DIRECTIONS_CLICKED]:"Conversion",[d.PAGE_VIEW]:"Navigation"})[a]||"Other"}generateReport(a="7days"){let b=Date.now(),c={"24hours":864e5,"7days":6048e5,"30days":2592e6},d=b-(c[a]||c["7days"]),e=this.events.filter(a=>a.timestamp>=d);return{timeRange:a,totalEvents:e.length,uniqueSessions:new Set(e.map(a=>a.sessionId)).size,eventBreakdown:this.getEventBreakdown(e),topSearches:this.getTopSearches(e),topStations:this.getTopStations(e),conversionRate:this.calculateConversionRate(e),avgTimeOnPage:this.calculateAvgTimeOnPage(e),popularFilters:this.getPopularFilters(e)}}getEventBreakdown(a){let b={};return a.forEach(a=>{b[a.type]=(b[a.type]||0)+1}),b}getTopSearches(a){let b=a.filter(a=>a.type===d.SEARCH_PERFORMED).map(a=>a.data.query).filter(Boolean),c={};return b.forEach(a=>{c[a]=(c[a]||0)+1}),Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,10).map(([a,b])=>({query:a,count:b}))}getTopStations(a){let b=a.filter(a=>a.type===d.STATION_VIEWED).map(a=>a.data.stationId).filter(Boolean),c={};return b.forEach(a=>{c[a]=(c[a]||0)+1}),Object.entries(c).sort((a,b)=>b[1]-a[1]).slice(0,10).map(([a,b])=>({stationId:a,views:b}))}calculateConversionRate(a){let b=a.filter(a=>a.type===d.STATION_VIEWED).length,c=a.filter(a=>a.type===d.DIRECTIONS_CLICKED||a.type===d.PHONE_CLICKED).length;return b>0?(c/b*100).toFixed(2):0}calculateAvgTimeOnPage(a){let b=a.filter(a=>a.type===d.TIME_ON_PAGE);return 0===b.length?0:Math.round(b.reduce((a,b)=>a+(b.data.duration||0),0)/b.length/1e3)}getPopularFilters(a){let b=a.filter(a=>a.type===d.FILTER_APPLIED).map(a=>a.data.filterType).filter(Boolean),c={};return b.forEach(a=>{c[a]=(c[a]||0)+1}),Object.entries(c).sort((a,b)=>b[1]-a[1]).map(([a,b])=>({filter:a,count:b}))}exportToCSV(){let a=new Blob([[["Timestamp","Event Type","Session ID","Page","Data"],...this.events.map(a=>[new Date(a.timestamp).toISOString(),a.type,a.sessionId,a.page,JSON.stringify(a.data)])].map(a=>a.join(",")).join("\n")],{type:"text/csv"}),b=URL.createObjectURL(a),c=document.createElement("a");c.href=b,c.download=`analytics_${Date.now()}.csv`,c.click(),URL.revokeObjectURL(b)}clearData(){this.events=[],localStorage.removeItem("ppnm_analytics")}}let f=new e,g=(a,b={})=>{try{f.trackEvent(a,b)}catch(a){}},h=a=>{try{g(d.PAGE_VIEW,{pageName:a})}catch(a){}},i=(a,b=0)=>{try{g(d.SEARCH_PERFORMED,{query:a,resultsCount:b})}catch(a){}},j=(a,b)=>{try{g(d.FILTER_APPLIED,{filterType:a,filterValue:b})}catch(a){}}}};