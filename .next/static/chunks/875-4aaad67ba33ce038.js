"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[875],{5875:(e,t,a)=>{a.d(t,{qh:()=>g,oe:()=>h,Ar:()=>p});var n=a(3576),r=a(2701),o=a(5364);let i=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{if(!window.gtag)return;window.gtag("event",e,(0,r._)((0,n._)({},t),{send_to:o.env.REACT_APP_GA_MEASUREMENT_ID}))}catch(e){}};var s=a(5364);let l={SEARCH_PERFORMED:"search_performed",FILTER_APPLIED:"filter_applied",STATION_VIEWED:"station_viewed",STATION_CLICKED:"station_clicked",DIRECTIONS_CLICKED:"directions_clicked",PHONE_CLICKED:"phone_clicked",PAGE_VIEW:"page_view",SESSION_END:"session_end",TIME_ON_PAGE:"time_on_page"};class c{generateSessionId(){return"session_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))}loadFromStorage(){if("undefined"!=typeof localStorage)try{let e=localStorage.getItem("ppnm_analytics");if(e){let t=JSON.parse(e);this.events=t.events||[]}}catch(e){console.warn("Failed to load analytics from storage:",e)}}saveToStorage(){if("undefined"!=typeof localStorage)try{let e={events:this.events.slice(-1e3),lastUpdated:Date.now()};localStorage.setItem("ppnm_analytics",JSON.stringify(e))}catch(e){console.warn("Failed to save analytics to storage:",e)}}trackEvent(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a={id:"event_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9)),type:e,timestamp:Date.now(),sessionId:this.sessionId,data:t,page:window.location.pathname,userAgent:navigator.userAgent};this.events.push(a),this.saveToStorage(),this.sendToExternalAnalytics(a)}catch(e){}}sendToExternalAnalytics(e){try{i(e.type,(0,n._)({event_category:this.getCategoryFromEventType(e.type),event_label:e.data.query||e.data.stationId||e.data.filterType||"unknown",value:e.data.value||0,session_id:this.sessionId,page_path:window.location.pathname},e.data))}catch(e){}try{window.fbq&&window.fbq("trackCustom",e.type,e.data)}catch(e){}s.env.REACT_APP_ANALYTICS_ENDPOINT&&fetch(s.env.REACT_APP_ANALYTICS_ENDPOINT,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).catch(e=>console.warn("Analytics endpoint error:",e))}getCategoryFromEventType(e){return({[l.SEARCH_PERFORMED]:"Search",[l.FILTER_APPLIED]:"Filter",[l.STATION_CLICKED]:"Engagement",[l.DIRECTIONS_CLICKED]:"Conversion",[l.PAGE_VIEW]:"Navigation"})[e]||"Other"}generateReport(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"7days",t=Date.now(),a={"24hours":864e5,"7days":6048e5,"30days":2592e6},n=t-(a[e]||a["7days"]),r=this.events.filter(e=>e.timestamp>=n);return{timeRange:e,totalEvents:r.length,uniqueSessions:new Set(r.map(e=>e.sessionId)).size,eventBreakdown:this.getEventBreakdown(r),topSearches:this.getTopSearches(r),topStations:this.getTopStations(r),conversionRate:this.calculateConversionRate(r),avgTimeOnPage:this.calculateAvgTimeOnPage(r),popularFilters:this.getPopularFilters(r)}}getEventBreakdown(e){let t={};return e.forEach(e=>{t[e.type]=(t[e.type]||0)+1}),t}getTopSearches(e){let t=e.filter(e=>e.type===l.SEARCH_PERFORMED).map(e=>e.data.query).filter(Boolean),a={};return t.forEach(e=>{a[e]=(a[e]||0)+1}),Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10).map(e=>{let[t,a]=e;return{query:t,count:a}})}getTopStations(e){let t=e.filter(e=>e.type===l.STATION_VIEWED).map(e=>e.data.stationId).filter(Boolean),a={};return t.forEach(e=>{a[e]=(a[e]||0)+1}),Object.entries(a).sort((e,t)=>t[1]-e[1]).slice(0,10).map(e=>{let[t,a]=e;return{stationId:t,views:a}})}calculateConversionRate(e){let t=e.filter(e=>e.type===l.STATION_VIEWED).length,a=e.filter(e=>e.type===l.DIRECTIONS_CLICKED||e.type===l.PHONE_CLICKED).length;return t>0?(a/t*100).toFixed(2):0}calculateAvgTimeOnPage(e){let t=e.filter(e=>e.type===l.TIME_ON_PAGE);return 0===t.length?0:Math.round(t.reduce((e,t)=>e+(t.data.duration||0),0)/t.length/1e3)}getPopularFilters(e){let t=e.filter(e=>e.type===l.FILTER_APPLIED).map(e=>e.data.filterType).filter(Boolean),a={};return t.forEach(e=>{a[e]=(a[e]||0)+1}),Object.entries(a).sort((e,t)=>t[1]-e[1]).map(e=>{let[t,a]=e;return{filter:t,count:a}})}exportToCSV(){if("undefined"==typeof document)return;let e=new Blob([[["Timestamp","Event Type","Session ID","Page","Data"],...this.events.map(e=>[new Date(e.timestamp).toISOString(),e.type,e.sessionId,e.page,JSON.stringify(e.data)])].map(e=>e.join(",")).join("\n")],{type:"text/csv"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="analytics_".concat(Date.now(),".csv"),a.click(),URL.revokeObjectURL(t)}clearData(){this.events=[],"undefined"!=typeof localStorage&&localStorage.removeItem("ppnm_analytics")}constructor(){this.events=[],this.sessionId=this.generateSessionId(),this.sessionStartTime=Date.now(),this.loadFromStorage(),document.addEventListener("visibilitychange",()=>{"hidden"===document.visibilityState&&this.trackEvent(l.SESSION_END,{duration:Date.now()-this.sessionStartTime,reason:"visibility_hidden"})}),window.addEventListener("pagehide",()=>{this.trackEvent(l.SESSION_END,{duration:Date.now()-this.sessionStartTime,reason:"page_hide"})})}}let d=new c,E=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{d.trackEvent(e,t)}catch(e){}},h=e=>{try{E(l.PAGE_VIEW,{pageName:e})}catch(e){}},p=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;try{E(l.SEARCH_PERFORMED,{query:e,resultsCount:t})}catch(e){}},g=(e,t)=>{try{E(l.FILTER_APPLIED,{filterType:e,filterValue:t})}catch(e){}}}}]);