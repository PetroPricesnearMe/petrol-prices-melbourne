# ğŸ”§ Vercel.json Schema Validation Fix

## âŒ Error

```
The vercel.json schema validation failed with the following message:
should NOT have additional property `projectId`
```

---

## ğŸ” Root Cause

Your `vercel.json` contained properties that belong in **Vercel Project Settings**, not in the configuration file.

### Invalid Properties Removed

| Property          | Why Invalid                        | Where It Belongs                       |
| ----------------- | ---------------------------------- | -------------------------------------- |
| `version`         | Deprecated in Vercel 3.0+          | Not needed anymore                     |
| `name`            | Not part of schema                 | Project Settings â†’ General             |
| `projectId`       | **Main Error** - Managed by Vercel | Auto-generated by Vercel               |
| `buildCommand`    | Not in schema                      | Project Settings â†’ Build & Development |
| `devCommand`      | Not in schema                      | Project Settings â†’ Build & Development |
| `installCommand`  | Not in schema                      | Project Settings â†’ Build & Development |
| `outputDirectory` | Not in schema                      | Auto-detected for Next.js              |
| `framework`       | Not in schema                      | Auto-detected by Vercel                |

---

## âœ… What Was Fixed

### Before (Invalid)

```json
{
  "version": 2,                              // âŒ Deprecated
  "name": "petrol-prices-melbourne",         // âŒ Not in schema
  "projectId": "prj_...",                    // âŒ MAIN ERROR
  "buildCommand": "next build",              // âŒ Not in schema
  "devCommand": "next dev",                  // âŒ Not in schema
  "installCommand": "npm install",           // âŒ Not in schema
  "outputDirectory": ".next",                // âŒ Not in schema
  "framework": "nextjs",                     // âŒ Auto-detected
  "regions": ["syd1"],                       // âœ… Valid
  "functions": { ... },                      // âœ… Valid
  "headers": [ ... ],                        // âœ… Valid
  "rewrites": [],                            // âœ… Valid
  "redirects": []                            // âœ… Valid
}
```

### After (Valid)

```json
{
  "regions": ["syd1"],                       // âœ… Valid
  "functions": {                             // âœ… Valid
    "src/app/api/**/*.ts": {
      "memory": 1024,
      "maxDuration": 10
    }
  },
  "crons": [],                               // âœ… Valid
  "headers": [ ... ],                        // âœ… Valid
  "rewrites": [],                            // âœ… Valid
  "redirects": []                            // âœ… Valid
}
```

---

## ğŸ“‹ Valid vercel.json Properties (2025)

### Core Configuration

- âœ… `regions` - Deployment regions (e.g., ["syd1"])
- âœ… `functions` - Serverless function configuration
- âœ… `crons` - Scheduled cron jobs

### Routing & Headers

- âœ… `headers` - Custom HTTP headers
- âœ… `redirects` - URL redirects
- âœ… `rewrites` - URL rewrites
- âœ… `cleanUrls` - Remove .html extension
- âœ… `trailingSlash` - Add/remove trailing slashes

### Advanced

- âœ… `env` - Environment variables (public only)
- âœ… `build` - Build configuration
- âœ… `github` - GitHub integration settings
- âœ… `git` - Git LFS settings

### **NOT** Valid (Common Mistakes)

- âŒ `version` - Deprecated
- âŒ `name` - Use project settings
- âŒ `projectId` - Managed by Vercel
- âŒ `buildCommand` - Use project settings
- âŒ `devCommand` - Use project settings
- âŒ `installCommand` - Use project settings
- âŒ `outputDirectory` - Auto-detected
- âŒ `framework` - Auto-detected

---

## ğŸš€ Deployment Instructions

### 1. Commit the Fix

```bash
git add vercel.json
git commit -m "fix: remove invalid properties from vercel.json"
git push origin main
```

### 2. Verify in Vercel Dashboard

If you need to set build commands:

1. Go to [vercel.com/dashboard](https://vercel.com/dashboard)
2. Select your project
3. Go to **Settings** â†’ **General**
4. Configure:
   - **Build Command:** `next build` (auto-detected)
   - **Output Directory:** `.next` (auto-detected)
   - **Install Command:** `npm install` (auto-detected)

### 3. Redeploy

```bash
# Trigger new deployment
git push origin main

# Or redeploy via Vercel dashboard
# Deployments â†’ [Latest] â†’ Redeploy
```

---

## ğŸ¯ Expected Result

### Before

```
âŒ Deployment Failed
Error: The vercel.json schema validation failed with the following message:
should NOT have additional property `projectId`
```

### After

```
âœ… Deployment Successful
âœ“ Building...
âœ“ Deploying...
âœ“ Ready! Available at https://petrolpricenearme.com.au
```

---

## ğŸ” Security Headers (Kept)

Your security headers configuration is **valid** and **recommended**:

```json
{
  "headers": [
    {
      "source": "/(.*)",
      "headers": [
        { "key": "X-DNS-Prefetch-Control", "value": "on" },
        { "key": "X-Frame-Options", "value": "SAMEORIGIN" },
        { "key": "X-Content-Type-Options", "value": "nosniff" },
        {
          "key": "Referrer-Policy",
          "value": "strict-origin-when-cross-origin"
        },
        {
          "key": "Permissions-Policy",
          "value": "camera=(), microphone=(), geolocation=(self)"
        }
      ]
    }
  ]
}
```

âœ… These protect against:

- Clickjacking (X-Frame-Options)
- MIME type sniffing (X-Content-Type-Options)
- Referrer leaks (Referrer-Policy)
- Unauthorized permissions (Permissions-Policy)

---

## ğŸš€ Performance Headers (Kept)

Your caching headers are **valid** and **optimal**:

```json
{
  "headers": [
    {
      "source": "/_next/static/(.*)",
      "headers": [
        {
          "key": "Cache-Control",
          "value": "public, max-age=31536000, immutable"
        }
      ]
    }
  ]
}
```

âœ… Caches static assets for 1 year, improving:

- Repeat visit performance
- Reduced server load
- Lower bandwidth costs

---

## ğŸ“ Next.config.ts Note

Some removed properties might be better in `next.config.ts`:

```typescript
// next.config.ts
const nextConfig: NextConfig = {
  // Headers (can also be here instead of vercel.json)
  async headers() {
    return [
      {
        source: '/:path*',
        headers: [
          { key: 'X-DNS-Prefetch-Control', value: 'on' },
          // ... other headers
        ],
      },
    ];
  },
};
```

**Current setup is fine** - you already have headers in both:

- `next.config.ts` - For all deployments
- `vercel.json` - Vercel-specific (takes precedence)

---

## âœ… Verification Checklist

After deploying:

- [ ] Deployment succeeds without schema errors âœ…
- [ ] Site accessible at production URL
- [ ] Security headers present (check DevTools â†’ Network)
- [ ] Cache headers working (check static assets)
- [ ] API routes functioning (if any)
- [ ] Build time reasonable (~2-5 minutes)
- [ ] No console errors on deployed site

---

## ğŸ†˜ Troubleshooting

### Still Getting Schema Error?

1. **Clear build cache:**

   ```bash
   # Vercel dashboard â†’ Settings â†’ General
   # Click "Clear Build Cache & Redeploy"
   ```

2. **Validate JSON syntax:**

   ```bash
   # Check for syntax errors
   cat vercel.json | jq .
   ```

3. **Check for hidden characters:**
   ```bash
   # View file with cat -A to see hidden chars
   cat -A vercel.json
   ```

### Deployment Still Fails?

1. **Check build logs:**
   - Vercel dashboard â†’ Deployments â†’ [Latest] â†’ Build Logs

2. **Verify Next.js build locally:**

   ```bash
   npm run build
   # Should succeed locally first
   ```

3. **Check environment variables:**
   - Vercel dashboard â†’ Settings â†’ Environment Variables
   - Ensure all required vars are set

---

## ğŸ“š Resources

### Official Documentation

- [Vercel Configuration](https://vercel.com/docs/projects/project-configuration)
- [vercel.json Reference](https://vercel.com/docs/configuration)
- [Next.js on Vercel](https://vercel.com/docs/frameworks/nextjs)

### Schema Validation

- [JSON Schema Validator](https://www.jsonschemavalidator.net/)
- [Vercel JSON Schema](https://vercel.com/docs/configuration/schema)

---

## ğŸ‰ Result

Your `vercel.json` is now:

âœ… **Schema compliant** - No validation errors  
âœ… **Minimal** - Only necessary configuration  
âœ… **Secure** - Security headers configured  
âœ… **Performant** - Cache headers optimized  
âœ… **Region optimized** - Deployed to Sydney (syd1)  
âœ… **Function configured** - API routes optimized

**Status: READY TO DEPLOY** ğŸš€

---

**Fixed:** November 10, 2025  
**Vercel Version:** 3.x  
**Next.js Version:** 15.x
